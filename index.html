<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Plan Builder - Interactive Activity</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B35;
            --secondary: #004E89;
            --accent: #FFD23F;
            --dark: #1A1A2E;
            --light: #F8F9FA;
            --success: #06D6A0;
            --white: #FFFFFF;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 1rem;
            color: var(--dark);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-family: 'Archivo Black', sans-serif;
            font-size: 3rem;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: -1px;
            margin-bottom: 0.5rem;
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        .header p {
            color: var(--accent);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .main-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .scenario-box {
            background: linear-gradient(135deg, var(--accent) 0%, #FFA94D 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 3px solid var(--dark);
            box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.1);
        }

        .scenario-box h2 {
            font-family: 'Archivo Black', sans-serif;
            color: var(--dark);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .scenario-box p {
            line-height: 1.7;
            color: var(--dark);
        }

        .progress-tracker {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
            padding: 0 1rem;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 5%;
            width: 90%;
            height: 4px;
            background: #E0E0E0;
            z-index: 0;
        }

        .progress-fill {
            position: absolute;
            top: 20px;
            left: 5%;
            height: 4px;
            background: var(--success);
            z-index: 1;
            transition: width 0.5s ease;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E0E0E0;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: all 0.3s ease;
            border: 3px solid var(--white);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .step.active .step-circle {
            background: var(--secondary);
            color: var(--white);
            transform: scale(1.2);
        }

        .step.completed .step-circle {
            background: var(--success);
            color: var(--white);
        }

        .step-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #666;
        }

        .step.active .step-label {
            color: var(--secondary);
            font-weight: 700;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        .section h3 {
            font-family: 'Archivo Black', sans-serif;
            color: var(--secondary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-left: 5px solid var(--primary);
            padding-left: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
            font-style: italic;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(0, 78, 137, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: #F8F9FA;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: #E9ECEF;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        button {
            padding: 1rem 2rem;
            font-family: 'DM Sans', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
            flex: 1;
        }

        .btn-primary:hover {
            background: #E85A2A;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: #E0E0E0;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #D0D0D0;
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #05C293;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 214, 160, 0.4);
        }

        .btn-success:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-save {
            background: var(--secondary);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-save:hover {
            background: #003D6E;
        }

        .validation-message {
            background: #FFF3CD;
            border: 2px solid #FFC107;
            color: #856404;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }

        .validation-message.show {
            display: block;
            animation: shake 0.5s ease;
        }

        .success-message {
            background: #D1F4E0;
            border: 2px solid var(--success);
            color: #0F5132;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .error-message {
            background: #F8D7DA;
            border: 2px solid #DC3545;
            color: #721C24;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .info-message {
            background: #E3F2FD;
            border: 2px solid var(--secondary);
            color: #0D47A1;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .tips-box {
            background: #E3F2FD;
            border-left: 4px solid var(--secondary);
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .tips-box h4 {
            color: var(--secondary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .tips-box ul {
            margin-left: 1.5rem;
            line-height: 1.8;
        }

        .summary-section {
            background: #F8F9FA;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .summary-section h4 {
            color: var(--secondary);
            margin-bottom: 1rem;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .summary-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid #DEE2E6;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 700;
            color: var(--dark);
            display: block;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            color: #495057;
            white-space: pre-wrap;
        }

        .completion-card {
            text-align: center;
            padding: 3rem 2rem;
        }

        .completion-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease infinite;
        }

        .completion-card h2 {
            font-family: 'Archivo Black', sans-serif;
            color: var(--success);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .completion-card p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .menu-builder {
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .menu-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #F8F9FA;
            border-radius: 8px;
        }

        .menu-item input {
            margin: 0;
        }

        .remove-btn {
            background: #DC3545;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .remove-btn:hover {
            background: #C82333;
        }

        .add-item-btn {
            background: var(--secondary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: inline-block;
        }

        .add-item-btn:hover {
            background: #003D6E;
        }

        .student-info-box {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 2px solid var(--secondary);
        }

        .student-info-box h4 {
            color: var(--secondary);
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .student-info-grid .form-group {
            margin-bottom: 0;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 2rem 3rem;
            border-radius: 15px;
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #E0E0E0;
            border-top-color: var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        /* Login/Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 2rem;
        }

        .welcome-screen h2 {
            font-family: 'Archivo Black', sans-serif;
            color: var(--secondary);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .welcome-screen p {
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .login-form .form-group {
            text-align: left;
        }

        .saved-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 700;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .saved-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        .auto-save-status {
            font-size: 0.85rem;
            color: #666;
            text-align: center;
            margin-top: 1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        .status-draft {
            background: #FFF3CD;
            color: #856404;
        }

        .status-submitted {
            background: #D1F4E0;
            color: #0F5132;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .main-card {
                padding: 1.5rem;
            }

            .progress-tracker {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .step {
                flex-basis: 33%;
            }

            .menu-item {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .student-info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Saved Indicator -->
    <div class="saved-indicator" id="savedIndicator">‚úì Progress Saved!</div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">Loading...</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üöÄ Business Plan Builder</h1>
            <p>Create Your Classroom Caf√© Business Plan</p>
        </div>

        <div class="main-card">
            <!-- Welcome/Login Screen -->
            <div class="section active" id="welcomeSection">
                <div class="welcome-screen">
                    <h2>üëã Welcome!</h2>
                    <p>Enter your details to start or continue working on your business plan.<br>Your progress is automatically saved so you can continue anytime.</p>
                    
                    <div class="login-form">
                        <div class="form-group">
                            <label>Student Name *</label>
                            <input type="text" id="loginName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label>Section/Class *</label>
                            <input type="text" id="loginSection" placeholder="e.g., Grade 9 - Section A">
                        </div>
                        <div id="loginError" class="error-message" style="display: none;"></div>
                        <div id="loginInfo" class="info-message" style="display: none;"></div>
                        <button class="btn-primary" onclick="startOrContinue()" style="width: 100%; margin-top: 1rem;">
                            Start / Continue My Plan ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Content (hidden until login) -->
            <div id="mainContent" style="display: none;">
                <div class="scenario-box">
                    <h2>üìã YOUR MISSION</h2>
                    <p>You and your team will launch a classroom caf√©! Parents, friends, and guardians will be your customers. Your task is to create a complete business plan that covers every aspect of your caf√© venture.</p>
                    <div style="margin-top: 1rem; font-size: 0.9rem;">
                        <strong>Student:</strong> <span id="displayName"></span> | 
                        <strong>Section:</strong> <span id="displaySection"></span>
                        <span class="status-badge status-draft" id="statusBadge">Draft</span>
                    </div>
                </div>

                <!-- Progress Tracker -->
                <div class="progress-tracker">
                    <div class="progress-line"></div>
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Summary</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Description</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Products</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Market</div>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-circle">5</div>
                        <div class="step-label">Marketing</div>
                    </div>
                    <div class="step" data-step="6">
                        <div class="step-circle">6</div>
                        <div class="step-label">Operations</div>
                    </div>
                    <div class="step" data-step="7">
                        <div class="step-circle">7</div>
                        <div class="step-label">Financial</div>
                    </div>
                </div>

                <div class="auto-save-status">
                    üíæ Your work is automatically saved as you type
                </div>

                <!-- Section 1: Executive Summary -->
                <div class="section active" id="section1">
                    <h3>1. Executive Summary</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Your caf√© name should be catchy and memorable</li>
                            <li>Mission statement explains WHY your caf√© exists</li>
                            <li>Keep it brief but exciting - make people want to visit!</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Caf√© Name *</label>
                        <input type="text" id="cafeName" placeholder="e.g., The Study Brew, Classroom Coffee Corner" onchange="autoSave()">
                        <div class="hint">Choose a creative, memorable name for your caf√©</div>
                    </div>

                    <div class="form-group">
                        <label>Mission Statement *</label>
                        <textarea id="mission" placeholder="Example: To provide students, parents, and teachers with a cozy space to enjoy quality beverages and treats while supporting our school community." onchange="autoSave()"></textarea>
                        <div class="hint">What is the purpose of your caf√©? What do you want to achieve?</div>
                    </div>

                    <div class="form-group">
                        <label>Brief Description *</label>
                        <textarea id="briefDesc" placeholder="Describe what your caf√© offers and what makes it special..." onchange="autoSave()"></textarea>
                        <div class="hint">Give a snapshot of your caf√© concept (2-3 sentences)</div>
                    </div>

                    <div class="form-group">
                        <label>Main Goal *</label>
                        <input type="text" id="mainGoal" placeholder="e.g., Raise ‚Ç±10,000 for our class fund while providing excellent service" onchange="autoSave()">
                        <div class="hint">What do you want to accomplish with this caf√©?</div>
                    </div>

                    <div class="validation-message" id="validation1"></div>

                    <div class="button-group">
                        <button class="btn-save" onclick="manualSave()">üíæ Save Progress</button>
                        <button class="btn-primary" onclick="nextSection(1)">Next Section ‚Üí</button>
                    </div>
                </div>

                <!-- Section 2: Business Description -->
                <div class="section" id="section2">
                    <h3>2. Business Description</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Your theme creates the atmosphere and experience</li>
                            <li>Think about what makes your caf√© unique and different</li>
                            <li>Consider your classroom space and how to transform it</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Type of Establishment *</label>
                        <select id="cafeType" onchange="autoSave()">
                            <option value="">Select type...</option>
                            <option value="coffee-shop">Coffee Shop</option>
                            <option value="cafe">Caf√©</option>
                            <option value="snack-bar">Snack Bar</option>
                            <option value="dessert-cafe">Dessert Caf√©</option>
                            <option value="juice-bar">Juice Bar</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Theme & Concept *</label>
                        <textarea id="theme" placeholder="e.g., Modern minimalist with plants, Retro diner style, Cozy bookshop caf√©, Tropical paradise..." onchange="autoSave()"></textarea>
                        <div class="hint">Describe the look, feel, and atmosphere of your caf√©</div>
                    </div>

                    <div class="form-group">
                        <label>Location Details *</label>
                        <input type="text" id="location" placeholder="e.g., Room 301, Grade 9 Classroom" onchange="autoSave()">
                        <div class="hint">Where will your caf√© be located?</div>
                    </div>

                    <div class="form-group">
                        <label>Operating Hours *</label>
                        <input type="text" id="hours" placeholder="e.g., 9:00 AM - 3:00 PM" onchange="autoSave()">
                    </div>

                    <div class="form-group">
                        <label>Unique Selling Proposition (USP) *</label>
                        <textarea id="usp" placeholder="What makes your caf√© different from others? Why should customers choose you?" onchange="autoSave()"></textarea>
                        <div class="hint">This is what sets you apart from the competition!</div>
                    </div>

                    <div class="validation-message" id="validation2"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(2)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="nextSection(2)">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Section 3: Products & Services -->
                <div class="section" id="section3">
                    <h3>3. Products & Services</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Offer a variety of items at different price points</li>
                            <li>Consider what your target customers would enjoy</li>
                            <li>Include at least one signature item that's uniquely yours</li>
                            <li>Price items to cover costs and make profit</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Menu Items *</label>
                        <div class="menu-builder" id="menuBuilder">
                            <div class="menu-item">
                                <input type="text" placeholder="Item name (e.g., Iced Mocha)" class="item-name" onchange="autoSave()">
                                <input type="number" placeholder="Price (‚Ç±)" class="item-price" min="0" step="5" onchange="autoSave()">
                                <select class="item-category" onchange="autoSave()">
                                    <option value="beverage">Beverage</option>
                                    <option value="snack">Snack</option>
                                    <option value="pastry">Pastry</option>
                                    <option value="dessert">Dessert</option>
                                </select>
                                <button class="remove-btn" onclick="removeMenuItem(this)" style="visibility: hidden;">Remove</button>
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addMenuItem()">+ Add Menu Item</button>
                        <div class="hint">Add all the items you plan to sell. Include at least 5 items.</div>
                    </div>

                    <div class="form-group">
                        <label>Service Style *</label>
                        <select id="serviceStyle" onchange="autoSave()">
                            <option value="">Select service style...</option>
                            <option value="counter">Counter Service (order at counter, pick up when ready)</option>
                            <option value="table">Table Service (servers bring orders to tables)</option>
                            <option value="self-serve">Self-Serve (customers serve themselves)</option>
                            <option value="hybrid">Hybrid (combination of styles)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Signature Item *</label>
                        <input type="text" id="signature" placeholder="e.g., Our famous Triple Chocolate Brownie" onchange="autoSave()">
                        <div class="hint">What's the ONE item your caf√© is known for?</div>
                    </div>

                    <div class="validation-message" id="validation3"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(3)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="nextSection(3)">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Section 4: Market Analysis -->
                <div class="section" id="section4">
                    <h3>4. Market Analysis</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Think about who will visit your caf√© and what they want</li>
                            <li>Consider age groups, preferences, and buying power</li>
                            <li>Understanding your customers helps you serve them better</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Target Customers *</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" class="target-customer" value="parents" onchange="autoSave()">
                                <span>Parents & Guardians</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="target-customer" value="students" onchange="autoSave()">
                                <span>Students</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="target-customer" value="teachers" onchange="autoSave()">
                                <span>Teachers & Staff</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="target-customer" value="visitors" onchange="autoSave()">
                                <span>School Visitors</span>
                            </label>
                        </div>
                        <div class="hint">Select all that apply (choose at least 2)</div>
                    </div>

                    <div class="form-group">
                        <label>Customer Needs & Preferences *</label>
                        <textarea id="customerNeeds" placeholder="What do your customers want? Consider: quality, price, convenience, atmosphere, healthy options, speed of service, etc." onchange="autoSave()"></textarea>
                        <div class="hint">List at least 3 things your target customers are looking for</div>
                    </div>

                    <div class="form-group">
                        <label>Expected Number of Customers *</label>
                        <input type="number" id="expectedCustomers" min="1" placeholder="e.g., 50" onchange="autoSave()">
                        <div class="hint">How many customers do you expect to serve?</div>
                    </div>

                    <div class="form-group">
                        <label>Market Opportunity *</label>
                        <textarea id="marketOpportunity" placeholder="Why is now a good time for your caf√©? What demand are you meeting?" onchange="autoSave()"></textarea>
                        <div class="hint">Explain why your caf√© will be successful</div>
                    </div>

                    <div class="validation-message" id="validation4"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(4)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="nextSection(4)">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Section 5: Marketing Plan -->
                <div class="section" id="section5">
                    <h3>5. Marketing Plan</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Use multiple promotional methods to reach more people</li>
                            <li>Start promoting early to build excitement</li>
                            <li>Make your branding consistent and memorable</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Promotional Strategies *</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" class="promo-strategy" value="flyers" onchange="autoSave()">
                                <span>Printed Flyers & Posters</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="promo-strategy" value="social-media" onchange="autoSave()">
                                <span>Social Media Posts</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="promo-strategy" value="word-of-mouth" onchange="autoSave()">
                                <span>Word of Mouth</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="promo-strategy" value="announcements" onchange="autoSave()">
                                <span>School Announcements</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" class="promo-strategy" value="email" onchange="autoSave()">
                                <span>Email/Messaging to Parents</span>
                            </label>
                        </div>
                        <div class="hint">Select at least 3 promotional methods</div>
                    </div>

                    <div class="form-group">
                        <label>Branding Elements *</label>
                        <textarea id="branding" placeholder="Describe your logo idea, color scheme, fonts, and overall visual style..." onchange="autoSave()"></textarea>
                        <div class="hint">What will your caf√©'s visual identity look like?</div>
                    </div>

                    <div class="form-group">
                        <label>Ticketing System *</label>
                        <select id="ticketing" onchange="autoSave()">
                            <option value="">Select ticketing method...</option>
                            <option value="pre-sale">Pre-sale Tickets Only</option>
                            <option value="door">Tickets at the Door</option>
                            <option value="both">Both Pre-sale and Door Sales</option>
                            <option value="reservation">Reservation System</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ticket Price *</label>
                        <input type="number" id="ticketPrice" min="0" step="10" placeholder="‚Ç±" onchange="autoSave()">
                        <div class="hint">How much will customers pay for entry/minimum consumption?</div>
                    </div>

                    <div class="form-group">
                        <label>Promotional Timeline *</label>
                        <textarea id="promoTimeline" placeholder="Week 1: Design posters and flyers&#10;Week 2: Distribute materials and post on social media&#10;Week 3: Send reminders and sell tickets&#10;Event Day: Welcome customers!" onchange="autoSave()"></textarea>
                        <div class="hint">When will you do each promotional activity?</div>
                    </div>

                    <div class="validation-message" id="validation5"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(5)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="nextSection(5)">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Section 6: Operations Plan -->
                <div class="section" id="section6">
                    <h3>6. Operations Plan</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Clearly define who does what to avoid confusion</li>
                            <li>Make sure every task is covered</li>
                            <li>Plan for setup, service, and cleanup</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Team Roles & Responsibilities *</label>
                        <textarea id="teamRoles" placeholder="Example:&#10;Manager: Oversees all operations, handles problems (2 members)&#10;Cashier: Handles payments and gives change (2 members)&#10;Baristas: Prepare beverages (4 members)&#10;Food Prep: Prepare snacks and pastries (3 members)&#10;Servers: Take orders and serve customers (3 members)&#10;Decorations Team: Setup and design (2 members)&#10;Cleanup Crew: Maintain cleanliness during and after (2 members)" onchange="autoSave()"></textarea>
                        <div class="hint">List all roles and how many people are assigned to each</div>
                    </div>

                    <div class="form-group">
                        <label>Equipment & Supplies Needed *</label>
                        <textarea id="equipment" placeholder="List everything you'll need: coffee maker, blender, cups, plates, napkins, tables, chairs, decorations, etc." onchange="autoSave()"></textarea>
                        <div class="hint">What tools and materials do you need to operate?</div>
                    </div>

                    <div class="form-group">
                        <label>Setup Procedure *</label>
                        <textarea id="setupProc" placeholder="Describe step-by-step how you'll set up the caf√© before opening..." onchange="autoSave()"></textarea>
                        <div class="hint">How will you prepare the space?</div>
                    </div>

                    <div class="form-group">
                        <label>Service Workflow *</label>
                        <textarea id="workflow" placeholder="Describe the process from when a customer arrives to when they leave. Who greets them? How do they order? How is food prepared? How is it served?" onchange="autoSave()"></textarea>
                        <div class="hint">Explain the customer journey step-by-step</div>
                    </div>

                    <div class="form-group">
                        <label>Cleanup Plan *</label>
                        <textarea id="cleanup" placeholder="How will you clean up during service and after closing?" onchange="autoSave()"></textarea>
                    </div>

                    <div class="validation-message" id="validation6"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(6)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="nextSection(6)">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Section 7: Financial Plan -->
                <div class="section" id="section7">
                    <h3>7. Financial Plan</h3>
                    
                    <div class="tips-box">
                        <h4>üí° Tips for This Section:</h4>
                        <ul>
                            <li>Be realistic with your numbers</li>
                            <li>Include ALL costs - even small ones add up</li>
                            <li>Make sure your prices cover costs and generate profit</li>
                            <li>Calculate break-even point to know minimum sales needed</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label>Startup Costs *</label>
                        <textarea id="startupCosts" placeholder="List all initial expenses:&#10;Ingredients: ‚Ç±2,000&#10;Disposable cups and plates: ‚Ç±500&#10;Decorations: ‚Ç±800&#10;Marketing materials: ‚Ç±300&#10;Equipment rental: ‚Ç±1,000&#10;Total: ‚Ç±4,600" onchange="autoSave()"></textarea>
                        <div class="hint">What money do you need to start? List each expense.</div>
                    </div>

                    <div class="form-group">
                        <label>Total Startup Investment Needed *</label>
                        <input type="number" id="totalStartup" min="0" step="50" placeholder="‚Ç±" onchange="autoSave()">
                        <div class="hint">Add up all your startup costs</div>
                    </div>

                    <div class="form-group">
                        <label>Projected Revenue *</label>
                        <textarea id="projectedRevenue" placeholder="Calculate expected income:&#10;Ticket sales: 50 customers √ó ‚Ç±50 = ‚Ç±2,500&#10;Food & beverage sales: 50 customers √ó ‚Ç±150 avg = ‚Ç±7,500&#10;Total projected revenue: ‚Ç±10,000" onchange="autoSave()"></textarea>
                        <div class="hint">How much money do you expect to make?</div>
                    </div>

                    <div class="form-group">
                        <label>Total Expected Revenue *</label>
                        <input type="number" id="totalRevenue" min="0" step="50" placeholder="‚Ç±" onchange="autoSave()">
                    </div>

                    <div class="form-group">
                        <label>Projected Profit *</label>
                        <input type="number" id="profit" min="0" step="50" placeholder="‚Ç±" onchange="autoSave()">
                        <div class="hint">Revenue minus total costs = Profit</div>
                    </div>

                    <div class="form-group">
                        <label>Funding Sources *</label>
                        <textarea id="funding" placeholder="Where will you get the startup money? (e.g., member contributions of ‚Ç±50 each, advance ticket sales, school support, etc.)" onchange="autoSave()"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Pricing Strategy Explanation *</label>
                        <textarea id="pricingStrategy" placeholder="Explain how you decided on your prices. Why are they competitive? How do they ensure profit?" onchange="autoSave()"></textarea>
                    </div>

                    <div class="validation-message" id="validation7"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(7)">‚Üê Previous</button>
                        <button class="btn-save" onclick="manualSave()">üíæ Save</button>
                        <button class="btn-primary" onclick="reviewPlan()">Review My Plan ‚Üí</button>
                    </div>
                </div>

                <!-- Review Section -->
                <div class="section" id="reviewSection">
                    <h3>üìä Business Plan Summary</h3>
                    
                    <p style="margin-bottom: 2rem; line-height: 1.6;">Review your complete business plan below. Make sure all information is accurate and complete. You can go back to any section to make changes.</p>

                    <div id="summaryContent"></div>

                    <div id="submitError" class="error-message" style="display: none;"></div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="prevSection(8)">‚Üê Edit Plan</button>
                        <button class="btn-success" id="submitBtn" onclick="submitPlan()">‚úì Submit Business Plan</button>
                    </div>
                </div>

                <!-- Completion Section -->
                <div class="section" id="completionSection">
                    <div class="completion-card">
                        <div class="completion-icon">üéâ</div>
                        <h2>Congratulations!</h2>
                        <p>You've successfully created and submitted your business plan!</p>
                        <p>Your teacher can now view your submission.</p>
                        
                        <div class="success-message" style="text-align: left; margin: 2rem 0;">
                            <strong>Next Steps:</strong>
                            <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                                <li>Review your plan with your team members</li>
                                <li>Wait for feedback from your teacher</li>
                                <li>Start implementing your operational plan</li>
                                <li>Begin your promotional campaign</li>
                                <li>Execute your caf√© event successfully!</li>
                            </ul>
                        </div>

                        <button class="btn-primary" onclick="downloadPlan()" style="margin-top: 1rem;">üì• Download Business Plan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        <script>
  // ===============================
  // GitHub Pages ‚Üí Google Apps Script storage bridge
  // Keeps original UI + logic unchanged
  // ===============================

  const APPS_SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbxq1lNGPH-yyWA25C8oPysSXUyOcSq27AXEuI7Z_V9vf4bXQYiWzePrEjgQzz3xGXvDUQ/exec";

  async function apiGet(action, params = {}) {
    const url = new URL(APPS_SCRIPT_URL);
    url.searchParams.set("action", action);
    Object.entries(params).forEach(([k, v]) =>
      url.searchParams.set(k, v ?? "")
    );
    const res = await fetch(url.toString());
    return await res.json();
  }

  async function apiPost(action, params = {}) {
    const body = new URLSearchParams();
    body.set("action", action);
    Object.entries(params).forEach(([k, v]) =>
      body.set(k, v ?? "")
    );

    const res = await fetch(APPS_SCRIPT_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
      },
      body: body.toString()
    });

    return await res.json();
  }

  // üîë THIS IS THE FIX
  // We recreate window.storage so your existing code works
  window.storage = {
    async get(key) {
      const name = businessPlan?.studentName || "";
      const result = await apiGet("load", {
        studentId: key,
        studentName: name
      });

      if (result && result.found && result.data) {
        return { value: result.data };
      }
      return null;
    },

    async set(key, value, isShared) {
      const parsed = JSON.parse(value);

      // Draft save
      if (!key.startsWith("submission_")) {
        return await apiPost("save", {
          studentId: key,
          studentName: parsed.studentName,
          data: value
        });
      }

      // Final submission
      return await apiPost("submit", {
        studentId: parsed.studentId || key.replace("submission_", ""),
        studentName: parsed.studentName,
        ...parsed
      });
    }
  };

        let currentSection = 1;
        const totalSections = 7;
        let businessPlan = {};
        let studentId = '';
        let autoSaveTimeout = null;

        // Generate a unique student ID from name and section
        function generateStudentId(name, section) {
            const combined = (name + '_' + section).toLowerCase().replace(/[^a-z0-9]/g, '_');
            return 'student_' + combined;
        }

        // Start or continue the business plan
        async function startOrContinue() {
            const name = document.getElementById('loginName').value.trim();
            const section = document.getElementById('loginSection').value.trim();
            const loginError = document.getElementById('loginError');
            const loginInfo = document.getElementById('loginInfo');

            if (!name || !section) {
                loginError.textContent = 'Please enter both your name and section.';
                loginError.style.display = 'block';
                loginInfo.style.display = 'none';
                return;
            }

            loginError.style.display = 'none';
            showLoading('Checking for saved progress...');

            studentId = generateStudentId(name, section);
            
            try {
                // Try to load existing data
                const result = await window.storage.get(studentId);
                
                if (result && result.value) {
                    businessPlan = JSON.parse(result.value);
                    loginInfo.textContent = '‚úì Found your saved progress! Loading...';
                    loginInfo.style.display = 'block';
                } else {
                    // New student
                    businessPlan = {
                        studentName: name,
                        studentSection: section,
                        status: 'draft',
                        currentSection: 1,
                        lastSaved: new Date().toISOString()
                    };
                    loginInfo.textContent = 'Starting a new business plan for you!';
                    loginInfo.style.display = 'block';
                }

                setTimeout(() => {
                    hideLoading();
                    showMainContent();
                }, 500);

            } catch (error) {
                // Key doesn't exist - new student
                businessPlan = {
                    studentName: name,
                    studentSection: section,
                    status: 'draft',
                    currentSection: 1,
                    lastSaved: new Date().toISOString()
                };
                hideLoading();
                showMainContent();
            }
        }

        // Show main content and populate form
        function showMainContent() {
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // Update display
            document.getElementById('displayName').textContent = businessPlan.studentName;
            document.getElementById('displaySection').textContent = businessPlan.studentSection;
            
            // Update status badge
            const badge = document.getElementById('statusBadge');
            if (businessPlan.status === 'submitted') {
                badge.textContent = 'Submitted';
                badge.className = 'status-badge status-submitted';
            } else {
                badge.textContent = 'Draft';
                badge.className = 'status-badge status-draft';
            }

            // Populate form fields
            populateForm();

            // Go to last section
            currentSection = businessPlan.currentSection || 1;
            showSection(currentSection);
            updateProgress();
        }

        // Populate form with saved data
        function populateForm() {
            // Section 1
            if (businessPlan.cafeName) document.getElementById('cafeName').value = businessPlan.cafeName;
            if (businessPlan.mission) document.getElementById('mission').value = businessPlan.mission;
            if (businessPlan.briefDesc) document.getElementById('briefDesc').value = businessPlan.briefDesc;
            if (businessPlan.mainGoal) document.getElementById('mainGoal').value = businessPlan.mainGoal;

            // Section 2
            if (businessPlan.cafeType) document.getElementById('cafeType').value = businessPlan.cafeType;
            if (businessPlan.theme) document.getElementById('theme').value = businessPlan.theme;
            if (businessPlan.location) document.getElementById('location').value = businessPlan.location;
            if (businessPlan.hours) document.getElementById('hours').value = businessPlan.hours;
            if (businessPlan.usp) document.getElementById('usp').value = businessPlan.usp;

            // Section 3 - Menu Items
            if (businessPlan.menuItems && businessPlan.menuItems.length > 0) {
                const menuBuilder = document.getElementById('menuBuilder');
                menuBuilder.innerHTML = '';
                businessPlan.menuItems.forEach((item, index) => {
                    const menuItem = document.createElement('div');
                    menuItem.className = 'menu-item';
                    menuItem.innerHTML = `
                        <input type="text" placeholder="Item name" class="item-name" value="${item.name || ''}" onchange="autoSave()">
                        <input type="number" placeholder="Price (‚Ç±)" class="item-price" min="0" step="5" value="${item.price || ''}" onchange="autoSave()">
                        <select class="item-category" onchange="autoSave()">
                            <option value="beverage" ${item.category === 'beverage' ? 'selected' : ''}>Beverage</option>
                            <option value="snack" ${item.category === 'snack' ? 'selected' : ''}>Snack</option>
                            <option value="pastry" ${item.category === 'pastry' ? 'selected' : ''}>Pastry</option>
                            <option value="dessert" ${item.category === 'dessert' ? 'selected' : ''}>Dessert</option>
                        </select>
                        <button class="remove-btn" onclick="removeMenuItem(this)" ${index === 0 ? 'style="visibility: hidden;"' : ''}>Remove</button>
                    `;
                    menuBuilder.appendChild(menuItem);
                });
            }
            if (businessPlan.serviceStyle) document.getElementById('serviceStyle').value = businessPlan.serviceStyle;
            if (businessPlan.signature) document.getElementById('signature').value = businessPlan.signature;

            // Section 4
            if (businessPlan.targetCustomers) {
                businessPlan.targetCustomers.forEach(customer => {
                    const checkbox = document.querySelector(`.target-customer[value="${customer}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            if (businessPlan.customerNeeds) document.getElementById('customerNeeds').value = businessPlan.customerNeeds;
            if (businessPlan.expectedCustomers) document.getElementById('expectedCustomers').value = businessPlan.expectedCustomers;
            if (businessPlan.marketOpportunity) document.getElementById('marketOpportunity').value = businessPlan.marketOpportunity;

            // Section 5
            if (businessPlan.promoStrategies) {
                businessPlan.promoStrategies.forEach(strategy => {
                    const checkbox = document.querySelector(`.promo-strategy[value="${strategy}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            if (businessPlan.branding) document.getElementById('branding').value = businessPlan.branding;
            if (businessPlan.ticketing) document.getElementById('ticketing').value = businessPlan.ticketing;
            if (businessPlan.ticketPrice) document.getElementById('ticketPrice').value = businessPlan.ticketPrice;
            if (businessPlan.promoTimeline) document.getElementById('promoTimeline').value = businessPlan.promoTimeline;

            // Section 6
            if (businessPlan.teamRoles) document.getElementById('teamRoles').value = businessPlan.teamRoles;
            if (businessPlan.equipment) document.getElementById('equipment').value = businessPlan.equipment;
            if (businessPlan.setupProc) document.getElementById('setupProc').value = businessPlan.setupProc;
            if (businessPlan.workflow) document.getElementById('workflow').value = businessPlan.workflow;
            if (businessPlan.cleanup) document.getElementById('cleanup').value = businessPlan.cleanup;

            // Section 7
            if (businessPlan.startupCosts) document.getElementById('startupCosts').value = businessPlan.startupCosts;
            if (businessPlan.totalStartup) document.getElementById('totalStartup').value = businessPlan.totalStartup;
            if (businessPlan.projectedRevenue) document.getElementById('projectedRevenue').value = businessPlan.projectedRevenue;
            if (businessPlan.totalRevenue) document.getElementById('totalRevenue').value = businessPlan.totalRevenue;
            if (businessPlan.profit) document.getElementById('profit').value = businessPlan.profit;
            if (businessPlan.funding) document.getElementById('funding').value = businessPlan.funding;
            if (businessPlan.pricingStrategy) document.getElementById('pricingStrategy').value = businessPlan.pricingStrategy;
        }

        // Auto-save with debounce
        function autoSave() {
            if (autoSaveTimeout) clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                saveProgress(false);
            }, 2000);
        }

        // Manual save
        function manualSave() {
            saveProgress(true);
        }

        // Save progress to storage
        async function saveProgress(showIndicator = true) {
            collectFormData();
            businessPlan.lastSaved = new Date().toISOString();
            businessPlan.currentSection = currentSection;

            try {
                await window.storage.set(studentId, JSON.stringify(businessPlan));
                
                if (showIndicator) {
                    const indicator = document.getElementById('savedIndicator');
                    indicator.classList.add('show');
                    setTimeout(() => indicator.classList.remove('show'), 2000);
                }
            } catch (error) {
                console.error('Save error:', error);
            }
        }

        // Collect all form data
        function collectFormData() {
            // Section 1
            businessPlan.cafeName = document.getElementById('cafeName').value;
            businessPlan.mission = document.getElementById('mission').value;
            businessPlan.briefDesc = document.getElementById('briefDesc').value;
            businessPlan.mainGoal = document.getElementById('mainGoal').value;

            // Section 2
            businessPlan.cafeType = document.getElementById('cafeType').value;
            businessPlan.theme = document.getElementById('theme').value;
            businessPlan.location = document.getElementById('location').value;
            businessPlan.hours = document.getElementById('hours').value;
            businessPlan.usp = document.getElementById('usp').value;

            // Section 3
            const menuItems = [];
            document.querySelectorAll('.menu-item').forEach(item => {
                const name = item.querySelector('.item-name').value.trim();
                const price = item.querySelector('.item-price').value;
                const category = item.querySelector('.item-category').value;
                if (name || price) {
                    menuItems.push({ name, price, category });
                }
            });
            businessPlan.menuItems = menuItems;
            businessPlan.serviceStyle = document.getElementById('serviceStyle').value;
            businessPlan.signature = document.getElementById('signature').value;

            // Section 4
            const targetCustomers = [];
            document.querySelectorAll('.target-customer:checked').forEach(cb => {
                targetCustomers.push(cb.value);
            });
            businessPlan.targetCustomers = targetCustomers;
            businessPlan.customerNeeds = document.getElementById('customerNeeds').value;
            businessPlan.expectedCustomers = document.getElementById('expectedCustomers').value;
            businessPlan.marketOpportunity = document.getElementById('marketOpportunity').value;

            // Section 5
            const promoStrategies = [];
            document.querySelectorAll('.promo-strategy:checked').forEach(cb => {
                promoStrategies.push(cb.value);
            });
            businessPlan.promoStrategies = promoStrategies;
            businessPlan.branding = document.getElementById('branding').value;
            businessPlan.ticketing = document.getElementById('ticketing').value;
            businessPlan.ticketPrice = document.getElementById('ticketPrice').value;
            businessPlan.promoTimeline = document.getElementById('promoTimeline').value;

            // Section 6
            businessPlan.teamRoles = document.getElementById('teamRoles').value;
            businessPlan.equipment = document.getElementById('equipment').value;
            businessPlan.setupProc = document.getElementById('setupProc').value;
            businessPlan.workflow = document.getElementById('workflow').value;
            businessPlan.cleanup = document.getElementById('cleanup').value;

            // Section 7
            businessPlan.startupCosts = document.getElementById('startupCosts').value;
            businessPlan.totalStartup = document.getElementById('totalStartup').value;
            businessPlan.projectedRevenue = document.getElementById('projectedRevenue').value;
            businessPlan.totalRevenue = document.getElementById('totalRevenue').value;
            businessPlan.profit = document.getElementById('profit').value;
            businessPlan.funding = document.getElementById('funding').value;
            businessPlan.pricingStrategy = document.getElementById('pricingStrategy').value;
        }

        function updateProgress() {
            const progress = ((currentSection - 1) / totalSections) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                if (stepNum < currentSection) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNum === currentSection) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        function showSection(num) {
            document.querySelectorAll('#mainContent .section').forEach(s => s.classList.remove('active'));
            const section = document.getElementById('section' + num);
            if (section) section.classList.add('active');
        }

        function validateSection(sectionNum) {
            let isValid = true;
            let message = '';

            switch(sectionNum) {
                case 1:
                    if (!document.getElementById('cafeName').value.trim()) {
                        message = 'Please enter a caf√© name.';
                        isValid = false;
                    } else if (!document.getElementById('mission').value.trim()) {
                        message = 'Please write a mission statement.';
                        isValid = false;
                    } else if (!document.getElementById('briefDesc').value.trim()) {
                        message = 'Please provide a brief description.';
                        isValid = false;
                    } else if (!document.getElementById('mainGoal').value.trim()) {
                        message = 'Please state your main goal.';
                        isValid = false;
                    }
                    break;

                case 2:
                    if (!document.getElementById('cafeType').value) {
                        message = 'Please select the type of establishment.';
                        isValid = false;
                    } else if (!document.getElementById('theme').value.trim()) {
                        message = 'Please describe your theme and concept.';
                        isValid = false;
                    } else if (!document.getElementById('location').value.trim()) {
                        message = 'Please specify the location.';
                        isValid = false;
                    } else if (!document.getElementById('hours').value.trim()) {
                        message = 'Please provide operating hours.';
                        isValid = false;
                    } else if (!document.getElementById('usp').value.trim()) {
                        message = 'Please describe your unique selling proposition.';
                        isValid = false;
                    }
                    break;

                case 3:
                    const menuItems = document.querySelectorAll('.menu-item');
                    let validItems = 0;
                    menuItems.forEach(item => {
                        const name = item.querySelector('.item-name').value.trim();
                        const price = item.querySelector('.item-price').value;
                        if (name && price) validItems++;
                    });

                    if (validItems < 5) {
                        message = 'Please add at least 5 menu items with names and prices.';
                        isValid = false;
                    } else if (!document.getElementById('serviceStyle').value) {
                        message = 'Please select a service style.';
                        isValid = false;
                    } else if (!document.getElementById('signature').value.trim()) {
                        message = 'Please specify your signature item.';
                        isValid = false;
                    }
                    break;

                case 4:
                    const checkedCustomers = document.querySelectorAll('.target-customer:checked');
                    if (checkedCustomers.length < 2) {
                        message = 'Please select at least 2 target customer groups.';
                        isValid = false;
                    } else if (!document.getElementById('customerNeeds').value.trim()) {
                        message = 'Please describe customer needs and preferences.';
                        isValid = false;
                    } else if (!document.getElementById('expectedCustomers').value) {
                        message = 'Please enter expected number of customers.';
                        isValid = false;
                    } else if (!document.getElementById('marketOpportunity').value.trim()) {
                        message = 'Please explain the market opportunity.';
                        isValid = false;
                    }
                    break;

                case 5:
                    const checkedPromo = document.querySelectorAll('.promo-strategy:checked');
                    if (checkedPromo.length < 3) {
                        message = 'Please select at least 3 promotional strategies.';
                        isValid = false;
                    } else if (!document.getElementById('branding').value.trim()) {
                        message = 'Please describe your branding elements.';
                        isValid = false;
                    } else if (!document.getElementById('ticketing').value) {
                        message = 'Please select a ticketing system.';
                        isValid = false;
                    } else if (!document.getElementById('ticketPrice').value) {
                        message = 'Please set a ticket price.';
                        isValid = false;
                    } else if (!document.getElementById('promoTimeline').value.trim()) {
                        message = 'Please create a promotional timeline.';
                        isValid = false;
                    }
                    break;

                case 6:
                    if (!document.getElementById('teamRoles').value.trim()) {
                        message = 'Please define team roles and responsibilities.';
                        isValid = false;
                    } else if (!document.getElementById('equipment').value.trim()) {
                        message = 'Please list equipment and supplies needed.';
                        isValid = false;
                    } else if (!document.getElementById('setupProc').value.trim()) {
                        message = 'Please describe the setup procedure.';
                        isValid = false;
                    } else if (!document.getElementById('workflow').value.trim()) {
                        message = 'Please explain the service workflow.';
                        isValid = false;
                    } else if (!document.getElementById('cleanup').value.trim()) {
                        message = 'Please describe the cleanup plan.';
                        isValid = false;
                    }
                    break;

                case 7:
                    if (!document.getElementById('startupCosts').value.trim()) {
                        message = 'Please itemize your startup costs.';
                        isValid = false;
                    } else if (!document.getElementById('totalStartup').value) {
                        message = 'Please enter total startup investment needed.';
                        isValid = false;
                    } else if (!document.getElementById('projectedRevenue').value.trim()) {
                        message = 'Please calculate projected revenue.';
                        isValid = false;
                    } else if (!document.getElementById('totalRevenue').value) {
                        message = 'Please enter total expected revenue.';
                        isValid = false;
                    } else if (!document.getElementById('profit').value) {
                        message = 'Please calculate projected profit.';
                        isValid = false;
                    } else if (!document.getElementById('funding').value.trim()) {
                        message = 'Please describe your funding sources.';
                        isValid = false;
                    } else if (!document.getElementById('pricingStrategy').value.trim()) {
                        message = 'Please explain your pricing strategy.';
                        isValid = false;
                    }
                    break;
            }

            const validationEl = document.getElementById('validation' + sectionNum);
            if (!isValid && validationEl) {
                validationEl.textContent = message;
                validationEl.classList.add('show');
                setTimeout(() => validationEl.classList.remove('show'), 5000);
            }

            return isValid;
        }

        function nextSection(from) {
            if (!validateSection(from)) return;

            saveProgress(false);
            
            document.getElementById('section' + from).classList.remove('active');
            currentSection = from + 1;
            document.getElementById('section' + currentSection).classList.add('active');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevSection(from) {
            saveProgress(false);
            
            if (from === 8) {
                document.getElementById('reviewSection').classList.remove('active');
                currentSection = 7;
            } else {
                document.getElementById('section' + from).classList.remove('active');
                currentSection = from - 1;
            }
            
            document.getElementById('section' + currentSection).classList.add('active');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function addMenuItem() {
            const menuBuilder = document.getElementById('menuBuilder');
            const newItem = document.createElement('div');
            newItem.className = 'menu-item';
            newItem.innerHTML = `
                <input type="text" placeholder="Item name" class="item-name" onchange="autoSave()">
                <input type="number" placeholder="Price (‚Ç±)" class="item-price" min="0" step="5" onchange="autoSave()">
                <select class="item-category" onchange="autoSave()">
                    <option value="beverage">Beverage</option>
                    <option value="snack">Snack</option>
                    <option value="pastry">Pastry</option>
                    <option value="dessert">Dessert</option>
                </select>
                <button class="remove-btn" onclick="removeMenuItem(this)">Remove</button>
            `;
            menuBuilder.appendChild(newItem);
        }

        function removeMenuItem(btn) {
            const menuBuilder = document.getElementById('menuBuilder');
            if (menuBuilder.querySelectorAll('.menu-item').length > 1) {
                btn.closest('.menu-item').remove();
                autoSave();
            }
        }

        function reviewPlan() {
            if (!validateSection(7)) return;
            collectFormData();
            saveProgress(false);

            const summaryContent = document.getElementById('summaryContent');
            let html = '';

            // Student Info
            html += `
                <div class="summary-section" style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border: 2px solid var(--secondary);">
                    <h4>üìù Student Information</h4>
                    <div class="summary-item">
                        <span class="summary-label">Student Name:</span>
                        <span class="summary-value">${businessPlan.studentName}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Section/Class:</span>
                        <span class="summary-value">${businessPlan.studentSection}</span>
                    </div>
                </div>
            `;

            // Section 1
            html += `
                <div class="summary-section">
                    <h4>1. Executive Summary</h4>
                    <div class="summary-item"><span class="summary-label">Caf√© Name:</span><span class="summary-value">${businessPlan.cafeName}</span></div>
                    <div class="summary-item"><span class="summary-label">Mission:</span><span class="summary-value">${businessPlan.mission}</span></div>
                    <div class="summary-item"><span class="summary-label">Description:</span><span class="summary-value">${businessPlan.briefDesc}</span></div>
                    <div class="summary-item"><span class="summary-label">Main Goal:</span><span class="summary-value">${businessPlan.mainGoal}</span></div>
                </div>
            `;

            // Section 2
            html += `
                <div class="summary-section">
                    <h4>2. Business Description</h4>
                    <div class="summary-item"><span class="summary-label">Type:</span><span class="summary-value">${businessPlan.cafeType}</span></div>
                    <div class="summary-item"><span class="summary-label">Theme:</span><span class="summary-value">${businessPlan.theme}</span></div>
                    <div class="summary-item"><span class="summary-label">Location:</span><span class="summary-value">${businessPlan.location}</span></div>
                    <div class="summary-item"><span class="summary-label">Hours:</span><span class="summary-value">${businessPlan.hours}</span></div>
                    <div class="summary-item"><span class="summary-label">USP:</span><span class="summary-value">${businessPlan.usp}</span></div>
                </div>
            `;

            // Section 3
            html += `<div class="summary-section"><h4>3. Products & Services</h4><div class="summary-item"><span class="summary-label">Menu Items:</span><ul style="margin-left: 1.5rem;">`;
            (businessPlan.menuItems || []).forEach(item => {
                if (item.name) html += `<li>${item.name} - ‚Ç±${item.price} (${item.category})</li>`;
            });
            html += `</ul></div>
                <div class="summary-item"><span class="summary-label">Service Style:</span><span class="summary-value">${businessPlan.serviceStyle}</span></div>
                <div class="summary-item"><span class="summary-label">Signature Item:</span><span class="summary-value">${businessPlan.signature}</span></div>
            </div>`;

            // Section 4
            html += `
                <div class="summary-section">
                    <h4>4. Market Analysis</h4>
                    <div class="summary-item"><span class="summary-label">Target Customers:</span><span class="summary-value">${(businessPlan.targetCustomers || []).join(', ')}</span></div>
                    <div class="summary-item"><span class="summary-label">Customer Needs:</span><span class="summary-value">${businessPlan.customerNeeds}</span></div>
                    <div class="summary-item"><span class="summary-label">Expected Customers:</span><span class="summary-value">${businessPlan.expectedCustomers}</span></div>
                    <div class="summary-item"><span class="summary-label">Market Opportunity:</span><span class="summary-value">${businessPlan.marketOpportunity}</span></div>
                </div>
            `;

            // Section 5
            html += `
                <div class="summary-section">
                    <h4>5. Marketing Plan</h4>
                    <div class="summary-item"><span class="summary-label">Promo Strategies:</span><span class="summary-value">${(businessPlan.promoStrategies || []).join(', ')}</span></div>
                    <div class="summary-item"><span class="summary-label">Branding:</span><span class="summary-value">${businessPlan.branding}</span></div>
                    <div class="summary-item"><span class="summary-label">Ticketing:</span><span class="summary-value">${businessPlan.ticketing}</span></div>
                    <div class="summary-item"><span class="summary-label">Ticket Price:</span><span class="summary-value">‚Ç±${businessPlan.ticketPrice}</span></div>
                </div>
            `;

            // Section 6
            html += `
                <div class="summary-section">
                    <h4>6. Operations Plan</h4>
                    <div class="summary-item"><span class="summary-label">Team Roles:</span><span class="summary-value">${businessPlan.teamRoles}</span></div>
                    <div class="summary-item"><span class="summary-label">Equipment:</span><span class="summary-value">${businessPlan.equipment}</span></div>
                </div>
            `;

            // Section 7
            html += `
                <div class="summary-section">
                    <h4>7. Financial Plan</h4>
                    <div class="summary-item"><span class="summary-label">Total Startup:</span><span class="summary-value">‚Ç±${businessPlan.totalStartup}</span></div>
                    <div class="summary-item"><span class="summary-label">Expected Revenue:</span><span class="summary-value">‚Ç±${businessPlan.totalRevenue}</span></div>
                    <div class="summary-item"><span class="summary-label">Projected Profit:</span><span class="summary-value">‚Ç±${businessPlan.profit}</span></div>
                </div>
            `;

            summaryContent.innerHTML = html;

            document.getElementById('section7').classList.remove('active');
            document.getElementById('reviewSection').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function submitPlan() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            showLoading('Submitting your business plan...');

            try {
                // Update status
                businessPlan.status = 'submitted';
                businessPlan.submittedAt = new Date().toISOString();

                // Save to personal storage
                await window.storage.set(studentId, JSON.stringify(businessPlan));

                // Save to shared storage for teacher to view
                const submissionKey = 'submission_' + studentId;
                await window.storage.set(submissionKey, JSON.stringify(businessPlan), true);

                hideLoading();
                
                // Update badge
                const badge = document.getElementById('statusBadge');
                badge.textContent = 'Submitted';
                badge.className = 'status-badge status-submitted';

                // Show completion
                document.getElementById('reviewSection').classList.remove('active');
                document.getElementById('completionSection').classList.add('active');
                
                document.getElementById('progressFill').style.width = '100%';
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.add('completed');
                    step.classList.remove('active');
                });
                
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Submit error:', error);
                hideLoading();
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úì Submit Business Plan';
                
                const submitError = document.getElementById('submitError');
                submitError.textContent = 'There was an error submitting. Please try again.';
                submitError.style.display = 'block';
            }
        }

        function downloadPlan() {
            let planText = `BUSINESS PLAN: ${businessPlan.cafeName}\n`;
            planText += `${'='.repeat(50)}\n\n`;
            planText += `STUDENT: ${businessPlan.studentName}\n`;
            planText += `SECTION: ${businessPlan.studentSection}\n`;
            planText += `STATUS: ${businessPlan.status}\n\n`;
            
            planText += `1. EXECUTIVE SUMMARY\n${'-'.repeat(50)}\n`;
            planText += `Cafe Name: ${businessPlan.cafeName}\n`;
            planText += `Mission: ${businessPlan.mission}\n`;
            planText += `Description: ${businessPlan.briefDesc}\n`;
            planText += `Main Goal: ${businessPlan.mainGoal}\n\n`;
            
            planText += `2. BUSINESS DESCRIPTION\n${'-'.repeat(50)}\n`;
            planText += `Type: ${businessPlan.cafeType}\n`;
            planText += `Theme: ${businessPlan.theme}\n`;
            planText += `Location: ${businessPlan.location}\n`;
            planText += `Hours: ${businessPlan.hours}\n`;
            planText += `USP: ${businessPlan.usp}\n\n`;
            
            planText += `3. PRODUCTS & SERVICES\n${'-'.repeat(50)}\n`;
            planText += `Menu Items:\n`;
            (businessPlan.menuItems || []).forEach(item => {
                if (item.name) planText += `  - ${item.name}: P${item.price} (${item.category})\n`;
            });
            planText += `Service Style: ${businessPlan.serviceStyle}\n`;
            planText += `Signature Item: ${businessPlan.signature}\n\n`;
            
            planText += `4. MARKET ANALYSIS\n${'-'.repeat(50)}\n`;
            planText += `Target Customers: ${(businessPlan.targetCustomers || []).join(', ')}\n`;
            planText += `Customer Needs: ${businessPlan.customerNeeds}\n`;
            planText += `Expected Customers: ${businessPlan.expectedCustomers}\n`;
            planText += `Market Opportunity: ${businessPlan.marketOpportunity}\n\n`;
            
            planText += `5. MARKETING PLAN\n${'-'.repeat(50)}\n`;
            planText += `Promo Strategies: ${(businessPlan.promoStrategies || []).join(', ')}\n`;
            planText += `Branding: ${businessPlan.branding}\n`;
            planText += `Ticketing: ${businessPlan.ticketing}\n`;
            planText += `Ticket Price: P${businessPlan.ticketPrice}\n`;
            planText += `Timeline: ${businessPlan.promoTimeline}\n\n`;
            
            planText += `6. OPERATIONS PLAN\n${'-'.repeat(50)}\n`;
            planText += `Team Roles:\n${businessPlan.teamRoles}\n\n`;
            planText += `Equipment:\n${businessPlan.equipment}\n\n`;
            planText += `Setup Procedure:\n${businessPlan.setupProc}\n\n`;
            planText += `Workflow:\n${businessPlan.workflow}\n\n`;
            planText += `Cleanup:\n${businessPlan.cleanup}\n\n`;
            
            planText += `7. FINANCIAL PLAN\n${'-'.repeat(50)}\n`;
            planText += `Startup Costs:\n${businessPlan.startupCosts}\n\n`;
            planText += `Total Investment: P${businessPlan.totalStartup}\n`;
            planText += `Projected Revenue:\n${businessPlan.projectedRevenue}\n\n`;
            planText += `Total Revenue: P${businessPlan.totalRevenue}\n`;
            planText += `Projected Profit: P${businessPlan.profit}\n`;
            planText += `Funding Sources:\n${businessPlan.funding}\n\n`;
            planText += `Pricing Strategy:\n${businessPlan.pricingStrategy}\n`;

            const blob = new Blob([planText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${(businessPlan.cafeName || 'Business_Plan').replace(/\s+/g, '_')}_Plan.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text || 'Loading...';
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>
